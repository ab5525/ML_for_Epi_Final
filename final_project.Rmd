---
title: "Final_Project"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(pacman)

pacman::p_load(pacman, Amelia, caret, cluster, devtools, factoextra, gbm, GGally, ggplot2, ggthemes, 
  ggvis, ggbiplot,httr, knitr,lubridate, plotly, pROC,randomForest, rio, rpart, rpart.plot, rmarkdown, shiny, 
  stringr, stats,tidyr, tidyverse) 

set.seed(123)
```


### Load Data

```{r process_data}
df <- import('data/C3longitudinal_clean.csv')
info_cols <- c('STATE','RecSource','DurationV0','age','household_size','air_travel','gender','race')
risk_cols <- c('smokeV0','esmokeV0','antiviral')
interest_cols <- c('early_vax_interest','delay_side_effects','delay_inconvenient','delay_trust','children_delay_se','children_delay_incon','children_delay_trust')
exposure_cols <- c('swimming_1','park_1','no_exp','swimming_2','park_2','no_exp2','movie_1','mall_1','church_1','movie_2','mall_2','church_2')
outcome_cols <- c('had_covid','booster','vaccinated')

df[,interest_cols]
```
```{r}
df <- na.omit(df)
library(dplyr)

df <- df %>% mutate(
   combined_1 = as.logical(swimming_1 + park_1 + movie_1 + mall_1 + church_1 + air_travel),
   combined_2 = as.logical(swimming_2 + park_2),
   combined_any = as.logical(swimming_1 + park_1 + movie_1 + mall_1 + church_1 + swimming_2 + park_2+ air_travel),
)
df
```

```{r propensity scoring}
# logistic regression for if someone ever went to exposure locations based on race, age, gender etc.  
ps.model.logit <- glm(combined_any ~ age + gender + race + household_size ,
                    data=df, family=binomial(link="logit"))
    summary(ps.model.logit)
    
    # estimates odds of eversmoke, then convert to probability (aka the propensity score)
    prop.score <- (predict(ps.model.logit, df, type="response"))
    df$PS.LOGIT <- prop.score
    
    # Logistic Regression model can be misspecified rather easily. Example, do age and smoking have a linear relationship?
    
   #temp<-table(nmesdata$eversmk, df$LASTAGE) 
    #pct.eversmk <- 100*(temp[2, ] / (temp[2,] + temp[1,]))
    #plot(40:94, pct.eversmk, xlab="Age", ylab="% ever smokers", pch=".", cex=7, cex.lab=1.5, cex.axis=1.5)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r unsupervised}

```


```{r}
logit <- glm(vaccinated ~ PS.LOGIT + hoax + early_vax_interest + air_travel ,
                    data=df, family=binomial(link="logit"))

summary(logit)
```

